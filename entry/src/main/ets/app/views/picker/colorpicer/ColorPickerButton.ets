import { ColorPickerView } from "./ColorPickerView"

@ComponentV2
export struct ColorPickerButton {
  // ======== å¤–éƒ¨å¯é…ç½®å‚æ•° ========
  @Param @Require currentColor: string                         // å½“å‰é¢œè‰²å€¼ï¼ˆä¾‹å¦‚ "#FF0000"ï¼‰
  @Event onColorPicked: (color: string) => void                 // é€‰ä¸­é¢œè‰²åçš„å›è°ƒ

  // ======== å¯é€‰å‚æ•°ï¼ˆå¸¦é»˜è®¤å€¼ï¼‰ ========
  @Param btnWidth: number        = 36
  @Param btnHeight: number       = 36
  @Param cornerRadius: number    = 5
  @Param btnBorderWidth: number  = 1

  // ======== å†…éƒ¨çŠ¶æ€ ========
  @Local private selectedColor: string ='#FF0000'    // å†…éƒ¨å®é™…æ˜¾ç¤ºé¢œè‰²


  aboutToAppear(){
    this.selectedColor = this.currentColor
  }

  // ======== æ„å»ºå…¥å£ ========
  build() {
    Rect()
      .width(this.btnWidth)
      .height(this.btnHeight)
      .fill(this.selectedColor)
      .radius(this.cornerRadius)
      .strokeWidth(this.btnBorderWidth)
      .bindMenu(this.buildColorPickerContent())
  }

  // ======== æ„å»ºé¢œè‰²é€‰æ‹©å™¨è§†å›¾ ========
  @Builder
  private buildColorPickerContent() {
    ColorPickerView({
      selectedColor: this.selectedColor,
      onColorPicked: (color: string) => {
        this.selectedColor = color             // ğŸ”¹ å†…éƒ¨é¢œè‰²ç«‹å³åˆ·æ–°
        this.onColorPicked(color)              // ğŸ”¹ é€šçŸ¥å¤–éƒ¨
      }
    })
  }
}